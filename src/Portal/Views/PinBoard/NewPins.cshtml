@using System.Threading.Tasks
@using Gloobster.Common
@using Gloobster.Enums
@using Newtonsoft.Json

@using Gloobster.Portal.ViewModels
@model PinBoardViewModel

@{
    ViewBag.MenuGroup = "Pins";
    ViewData["Title"] = "New pins";
    Layout = "_LayoutNew";
}

<link href="/lib/mapbox.js/mapbox.css" rel="stylesheet" />
<link href="/lib/leaflet/dist/leaflet.css" rel="stylesheet" />

@if (GloobsterConfig.UseMiniScripts)
{
    <script src="/jsb/pins.js" type="text/javascript" data-notbuild="true"></script>
}
else
{

    <link href="~/css/main.css" rel="stylesheet" />

    <script type="text/javascript" src="/lib/leaflet/dist/leaflet.js"></script>
    <script type="text/javascript" src="/lib/mapbox.js/mapbox.js"></script>

    <script type="text/javascript" src="/lib/leaflet-heat.js"></script>

    <script type="text/javascript" src="/js/Maps/MapsInterfaces.js"></script>

    <script type="text/javascript" src="/js/common/ShareButtons.js"></script>

    <script type="text/javascript" src="/js/Common/CountryShapes.js"></script>
    <script type="text/javascript" src="/js/Common/UsStates.js"></script>
    <script type="text/javascript" src="/js/Common/CountryCodes.js"></script>
    <script type="text/javascript" src="/js/Common/FacebookPermissions.js"></script>

    <script type="text/javascript" src="/js/Maps/BaseMapsOperation3D.js"></script>
    <script type="text/javascript" src="/js/Maps/BaseMapsOperation2D.js"></script>
    <script type="text/javascript" src="/js/Maps/MapsOperations.js"></script>
    <script type="text/javascript" src="/js/Maps/MapsCreatorGlobe3D.js"></script>
    <script type="text/javascript" src="/js/Maps/MapsCreatorMapBox2D.js"></script>
    <script type="text/javascript" src="/js/Maps/MapsManager.js"></script>
    <script type="text/javascript" src="/js/Maps/MapsDataLoader.js"></script>

    <script type="text/javascript" src="/js/Views/PinBoardView.js"></script>
    <script type="text/javascript" src="/js/pins/Switcher.js"></script>
    <script type="text/javascript" src="/js/pins/ShareDialogPinsView.js"></script>
    <script type="text/javascript" src="/js/pins/PeopleFilter.js"></script>
    <script type="text/javascript" src="/js/pins/AggregatedCountries.js"></script>
    <script type="text/javascript" src="/js/pins/PinBoardBadges.js"></script>
}

@Html.Partial("PinBoardTemplates")

@{
    var topCitiesStr = $"[{string.Join(",", Model.TopCities)}]";
    var countryCodesStr = $"['{string.Join("','", Model.CountryCodes)}']";
    var stateCodesStr = $"['{string.Join("','", Model.StateCodes)}']";
}

<h1>Your travel map</h1>

<p>
    @Model.W("Description")
</p>

<div class="icons_all wrapper">
    <div class="block data-type">
        <div class="ico_all pr">
            <div class="ico">
                <a data-gv="0" href="#"><span class="icon-city"></span></a>
            </div>
            <div class="txt">
                @Model.W("Cities")
            </div>
        </div>
        <div class="ico_all pr">
            <div class="ico">
                <a data-gv="1" href="#"><span class="icon-country"></span></a>
            </div>
            <div class="txt">
                @Model.W("Countries")
            </div>
        </div>
        <div class="ico_all">
            <div class="ico">
                <a data-gv="2" href="#"><span class="icon-places"></span></a>
            </div>
            <div class="txt">
                @Model.W("Places")
            </div>
        </div>
    </div>

    <div class="block data-set">
        <div class="ico_all pr">
            <div class="ico">
                <a data-gv="0" href="#"><span class="icon-my-data"></span></a>
            </div>
            <div class="txt">
                @Model.W("MyData")
            </div>
        </div>
        <div class="ico_all pr">
            <div class="ico">
                <a data-gv="1" href="#"><span class="icon-friends-data"></span></a>
            </div>
            <div class="txt">
                <div class="cmb_all">
                    <a id="friendsCmb" class="cmb" href="#">@Model.W("Friends") <span class="icon-dropdown-arrow"></span></a>
                    <div class="list" style="display: none">
                        <div class="clear" style="display: none">
                            <a href="#">@Model.W("FilterReset")</a>
                        </div>
                        <div class="cont">
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="ico_all">
            <div class="ico">
                <a data-gv="2" href="#"><span class="icon-everybody-data"></span></a>
            </div>
            <div class="txt">
                @Model.W("Everybody")
            </div>
        </div>
    </div>
</div>

@Html.Partial("ShareDialog")

<div id="map"></div>

<div class="wrapper stats">
    <table>
        <tr>
            <td>
                <div>
                    <strong id="CitiesCount" class="countto" data-from="0" data-to="@Model.Cities">0</strong>
                    <br/>
                    @Model.W("StatCities")
                </div>
            </td>
            <td>
                <div class="bor">
                    <strong id="CountriesCount" class="countto" data-from="0" data-to="@Model.Countries">0</strong>
                    <br/>
                    @Model.W("StatCountries")
                </div>
            </td>
            <td>
                <div class="bor">
                    <strong>
                        <span id="TraveledPercent" class="countto" data-from="0" data-to="@Model.WorldTraveled">0</span>%
                    </strong>
                    <br />
                    @Model.W("WorldTraveled")
                </div>
            </td>
            <td>
                <div class="bor">
                    <strong id="StatesCount" class="countto" data-from="0" data-to="@Model.UsStates">0</strong>
                    <br />
                    @Model.W("UsStates")
                </div>
            </td>
        </tr>
    </table>

</div>

<div id="overview" class="badges">
    
</div>

<div id="cities" class="cities_all wrapper">


</div>
 
<script id="badges-frame-template" type="text/x-handlebars-template">
    <div class="continent">
        <h2 class="title">{{title}}</h2>
        <div class="cities">
            <table></table>
        </div>
    </div>

</script>

<script id="badge-city-template" type="text/x-handlebars-template">
    <td>
        <div class="badge_all" data-gid="{{gid}}">
            <div class="icon">
                <img src=""/>
            </div>
            <div class="txt">
                
            </div>
        </div>
    </td>
</script>

    <script id="badge-over-template" type="text/x-handlebars-template">

        <div class="badge_all">
            <div class="icon">
                <img src="{{imgLink}}" />
            </div>
            <div class="txt">
                {{visitedCnt}}/{{totalCnt}} <strong>{{name}}</strong>
            </div>
        </div>

    
</script>



    <script id="map-controls-template" type="text/x-handlebars-template">
        <div class="place-search">
            <input id="citiesInput" class="inputed" type="text" placeholder="@Model.W("PlaceName")">
            <img class="loader" src="/images/loader-gray.gif" style="display: none" />
            <div class="results" style="display: none;">

                <div class="base-cont">
                    <ul class="ul-city"></ul>
                    <ul class="ul-country"></ul>
                </div>

                <a class="search-soc" href="#">@Model.W("SearchOnSoc")</a>
                <div class="soc-nets"></div>

            </div>
        </div>


        <div id="mapType" class="map-type dropdown">
            <span class="selected">@Model.W("Map2D")</span>
            <ul>
                <li data-value="0">@Model.W("Map2D")</li>
                <li data-value="1">@Model.W("Map3D")</li>
            </ul>
            <input id="mapTypeValue" type="hidden" value="0">
        </div>

        <div class="share">
            <span id="share-btn" class="icon-share" title="@Model.W("ShareMap")"></span>
        </div>
    </script>

<script id="item-template" type="text/x-handlebars-template">

        <div class="item" data-value="{{id}}">
            <input data-val="{{id}}" id="chck{{id}}" type="checkbox">
            <label for="chck{{id}}">{{displayName}}</label>
        </div>

    </script>

<script id="legend-template" type="text/x-handlebars-template">
    <div id="countriesLegend" class="my-legend">
    <div class='legend-title'>@Model.W("VisitingFrequency")</div>
    <div class='legend-scale'>
        <ul class='legend-labels'>
            <li><span style='background: #0026BF;'></span>1</li>
            <li><span style='background: #1300C2;'></span>2</li>
            <li><span style='background: #4F00C6;'></span>3</li>
            <li><span style='background: #8D00CA;'></span>4</li>
            <li><span style='background: #CE00CE;'></span>5</li>
            <li><span style='background: #D20092;'></span>6</li>
            <li><span style='background: #D50055;'></span>7</li>
            <li><span style='background: #D90015;'></span>8</li>
            <li><span style='background: #DD2C00;'></span>9</li>
            <li><span style='background: #E17000;'></span>10</li>
            <li><span style='background: #E5B600;'></span>&gt;10</li>
        </ul>
    </div>
</div>
</script>

<script>

    function onBodyLoad() {
        currentView = new Views.PinBoardView();

        currentView.initialize();

        currentView.pinBoardBadges.cities = @Html.Raw(topCitiesStr);
        currentView.pinBoardBadges.countries = @Html.Raw(countryCodesStr);
        currentView.pinBoardBadges.states = @Html.Raw(stateCodesStr);

        var gidToTitle = @Html.Raw(JsonConvert.SerializeObject(Model.GidToTitle));
        currentView.pinBoardBadges.gidToTitle = gidToTitle;

        var friends = @Html.Raw(JsonConvert.SerializeObject(Model.Friends));
        var f = _.map(friends, function(i) { return {id: i.Id, displayName: i.DisplayName};});
        currentView.peopleFilter.initFriends(f);

        //Model.ShowFacebookPermissionsDialog &&
        @if (Model.HasSocNet(SocialNetworkType.Facebook))
        {
            @Html.Raw("currentView.initFb();")
        }

        currentView.setShareText(@Model.Cities, @Model.Countries);
    }

</script>
