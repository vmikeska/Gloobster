@{
    ViewData["Title"] = "About";
}
<h2>@ViewData["Title"].</h2>
<h3>@ViewData["Message"]</h3>



<head>
    <script src="http://www.webglearth.com/v2/api.js"></script>

    <script type="text/javascript" src="@Url.Content("~/js/CountryShapes.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/js/CountryCodes.js")"></script>
    <script type="text/javascript" src="@Url.Content("~/js/MapsDisplayer.js")"></script>
		<script type="text/javascript" src="@Url.Content("~/js/MapsCreator.js")"></script>
		<script type="text/javascript" src="@Url.Content("~/js/ViewBase.js")"></script>
		<script type="text/javascript" src="@Url.Content("~/js/PinBoardView.js")"></script>
		


		
    <script>
	    function initialize() {
		    var pinBoardView = new PinBoardView();
		    pinBoardView.initialize();

		    $("#countriesAutocomplet").on("input", function() {
			    var placeName = $("#countriesAutocomplet").val();

			    var url = '/api/place?placeName=' + placeName;

			    makeApiCall(url, function(response) {

			    	var htmlContent = '';
				    response.forEach(function(item) {

				    		if (item.population > 0) {
				    				htmlContent += getItemHtml(item);
								}								
				    });

				    $("#countriesResult").html(htmlContent);
				    $(".cityMenuItem").unbind();
				    $(".cityMenuItem").click(function (item) {
				    		var geoId = $(item.currentTarget).data('id');

				    		var dataRecord = _.find(response, { 'geonameId': geoId });

				    		pinBoardView.setView(dataRecord.lat, dataRecord.lng);
				    });

			    });

			    
		    });

		    
	    }

				function getItemHtml(item) {
						return '<div class="cityMenuItem" data-id="' + item.geonameId + '">' + item.name + ', ' + item.countryName + ' (pop: ' + item.population + ')' + '</div>';
				}

	    function makeApiCall(url, callback) {
		    $.ajax({
			    type: 'GET',
			    url: url,
			    success(response) {
				    callback(response);
			    },
			    error(res) {

				    //todo: some universal error handler
				    alert(JSON.stringify(res));
			    }
		    });
	    }

    </script>
</head>
<body onload="initialize()">

		<input type="text" id="countriesAutocomplet"/>
		<div id="countriesResult" style="border: 1px solid red"></div>


		<div id="earth_div" style="width: 800px; height: 600px; border: 1px solid black;"></div>
</body>
