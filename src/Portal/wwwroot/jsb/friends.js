var __extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},FriendActionType;!function(e){e[e.Confirm=0]="Confirm",e[e.Request=1]="Request",e[e.Unfriend=2]="Unfriend",e[e.Block=3]="Block",e[e.CancelRequest=4]="CancelRequest"}(FriendActionType||(FriendActionType={}));var FriendshipState;!function(e){e[e.None=0]="None",e[e.Friends=1]="Friends",e[e.Proposed=2]="Proposed",e[e.AwaitingConfirmation=3]="AwaitingConfirmation",e[e.Blocked=4]="Blocked"}(FriendshipState||(FriendshipState={}));var Friend=function(){function e(){}return e}(),FriendsView=function(e){function t(){e.call(this)}return __extends(t,e),Object.defineProperty(t.prototype,"pageType",{get:function(){return Views.PageType.Friends},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.$usersTable=$("#usersTable"),this.getUsersAndDisplay(),$("#friendsSearch").on("input",function(){var t=$("#friendsSearch input").val();e.searchUsers(t)}),this.friendItemTemplate=this.registerTemplate("friendItem-template"),this.friendMenuTemplate=this.registerTemplate("friendMenu-template"),this.friendSearchTemplate=this.registerTemplate("friend-search-item-template")},t.prototype.getUsersAndDisplay=function(){var e=this;$(".actionButton").unbind(),this.apiGet("Friends",null,function(t){var n=e.generateAllSections(t);$(".friendsContainer").html(n),e.registerButtonActions()})},t.prototype.searchUsers=function(e){var t=this,n=1;if(e.length<n)return void this.clearSearchBox();var i=[["searchQuery",e]];this.apiGet("usersSearch",i,function(e){t.fillUsersSearchBoxHtml(e)})},t.prototype.clearSearchBox=function(){$("#friendsSearch ul").html("")},t.prototype.fillUsersSearchBoxHtml=function(e){var t=this;$("#friendsSearch ul").show();var n="";e.forEach(function(e){n+=t.getItemHtml(e)}),$("#friendsSearch ul").html(n),$("#friendsSearch button").click(function(n){n.preventDefault();var i=$(n.currentTarget).data("value");t.requestUser(i,e),$("#friendsSearch input").val("")})},t.prototype.getItemHtml=function(e){var t={friendId:e.friendId,displayName:e.displayName},n=this.friendSearchTemplate(t);return n},t.prototype.requestUser=function(e,t){var n=this;$("#friendsSearch ul").hide();var i={friendId:e,action:FriendActionType.Request};this.apiPost("Friends",i,function(e){n.userStateChanged(e)})},t.prototype.generateAllSections=function(e){if(this.$usersTable.html('<tr><td colspan="3"></td></tr>'),e.Friends.length>0){var t=this.t("Friends","jsFriends"),n=this.convertFriends(e.Friends,FriendshipState.Friends);this.generateSection(t,n)}if(e.AwaitingConfirmation.length>0){var i=this.t("AwaitingConfirm","jsFriends"),r=this.convertFriends(e.AwaitingConfirmation,FriendshipState.AwaitingConfirmation);this.generateSection(i,r)}if(e.FacebookRecommended.length>0){var o=this.t("RecommByFb","jsFriends"),a=this.convertFriends(e.FacebookRecommended,FriendshipState.None);this.generateSection(o,a)}if(e.Proposed.length>0){var s=this.t("AlreadyProposed","jsFriends"),d=this.convertFriends(e.Proposed,FriendshipState.Proposed);this.generateSection(s,d)}},t.prototype.registerButtonActions=function(){var e=this;$(".actionButton").click(function(t){t.preventDefault();var n=$(t.target).data("value"),i=$(t.target).data("action"),r={friendId:n,action:i};e.apiPost("Friends",r,function(t){e.userStateChanged(t)})})},t.prototype.userStateChanged=function(e){$(".actionButton").unbind();var t=this.generateAllSections(e);$(".friendsContainer").html(t),this.registerButtonActions()},t.prototype.convertFriends=function(e,t){var n=this,i=_.map(e,function(e){return n.convertFriend(e,t)});return i},t.prototype.convertFriend=function(e,t){var n=new Friend;return n.photoUrl=e.photoUrl,n.friendId=e.friendId,n.state=t,n.displayName=e.displayName,n},t.prototype.generateSection=function(e,t){var n=this,i='<tr><td class="sect-title" colspan="3"><h4>'+e+"</h4></td></tr>";this.addRow(i),t.forEach(function(e){n.generateOneFriendItem(e)})},t.prototype.getActionsByState=function(e){return e===FriendshipState.Friends?[FriendActionType.Unfriend]:e===FriendshipState.AwaitingConfirmation?[FriendActionType.Confirm]:e===FriendshipState.Proposed?[FriendActionType.CancelRequest]:e===FriendshipState.None?[FriendActionType.Request]:[]},t.prototype.generateOneFriendItem=function(e){var t=this.getActionsByState(e.state),n=e.state===FriendshipState.Friends?this.generateFriendAction(e.friendId):this.generateActions(e.friendId,t),i={id:e.friendId,name:e.displayName,actionsHtml:n},r=this.friendItemTemplate(i),o=$(r);o.find(".actions").html(n),this.addRow(o)},t.prototype.addRow=function(e){$("#usersTable tr:last").after(e)},t.prototype.generateFriendAction=function(e){var t=this,n=this.friendMenuTemplate({id:e}),i=$(n);return Common.DropDown.registerDropDown(i),i.find(".unfriend").click(function(e){e.preventDefault();var n=$(e.target).data("fid"),i={friendId:n,action:FriendActionType.Unfriend};t.apiPost("Friends",i,function(e){t.userStateChanged(e)})}),i},t.prototype.generateActions=function(e,t){var n=this,i="";return t.forEach(function(t){var r=n.t(FriendActionType[t],"jsFriends"),o='<button class="actionButton" data-value="'+e+'" data-action="'+t+'">'+r+"</button>";i+=o}),i},t}(Views.ViewBase);