var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Views;!function(t){!function(t){t[t.Continent=0]="Continent",t[t.Country=1]="Country",t[t.City=2]="City"}(t.ArticleType||(t.ArticleType={}));var e=(t.ArticleType,function(e){function a(t,n){e.call(this),this.articleType=n,this.articleId=t,this.langVersion=this.getLangVersion(),this.photos=new r(t),this.rating=new o(t,this.langVersion),this.report=new i(t,this.langVersion),this.regContribute()}return __extends(a,e),a.prototype.regContribute=function(){$(".contrib-link").click(function(e){if(e.preventDefault(),t.ViewBase.currentView.fullReg){var i=$(e.target),o=i.closest(".empty-cont");if(o.length>0){var r=o.data("sid");$('.article_rating[data-id="'+r+'"]').find(".bubble").toggle()}}else n.displayFullRegMessage()})},a.prototype.getLangVersion=function(){var t=window.location.pathname.split("/");return t[2]},a}(t.ViewBase));t.WikiPageView=e;var i=function(){function e(t,e){var i=this;this.regToggleButton(),this.articleId=t,this.langVersion=e,this.$bubble=$(".bubble"),this.$bubble.find(".cancel").click(function(t){t.preventDefault();var e=$(t.target);i.toggleForm(e)}),this.regSend()}return e.prototype.toggleForm=function(t){t.closest(".article_rating").find(".bubble").toggle()},e.prototype.regSend=function(){var e=this;this.$bubble.find(".send").click(function(i){i.preventDefault();var n=$(i.target),o=n.closest(".article_rating"),r=n.closest(".bubble"),a={lang:e.langVersion,articleId:e.articleId,sectionId:o.data("id"),text:r.find(".txt").val()},s=t.ViewBase.currentView;s.apiPost("WikiReport",a,function(t){e.toggleForm(n);var i=new Common.InfoDialog;i.create(s.t("ContributionThanksTitle","jsWiki"),s.t("ContributionThanksBody","jsWiki"))})})},e.prototype.regToggleButton=function(){var e=this;$(".icon-edit-pencil").click(function(i){if(i.preventDefault(),t.ViewBase.currentView.fullReg){var o=$(i.target);e.toggleForm(o)}else n.displayFullRegMessage()})},e}();t.Report=i;var n=function(){function e(){}return e.displayFullRegMessage=function(){var e=new Common.InfoDialog,i=t.ViewBase.currentView;e.create(i.t("FullRegTitle","jsWiki"),i.t("FullRegBody","jsWiki"))},e}();t.RegMessages=n;var o=function(){function e(t,e){this.regRating(),this.regRatingDD(),this.regRatingPrice(),this.articleId=t,this.langVersion=e}return e.prototype.getRatingDesign=function(t){var e={rstr:t,cls:""};return t>0?(e.rstr="+"+t,e.cls="plus"):e.cls="minus",e},e.prototype.regRatingDD=function(){var t=this;this.regRatingBase("pmBtn","item","WikiRating",function(e){t.setLikeDislike(e.$cont,e.like,"pmBtn")})},e.prototype.regRatingPrice=function(){var t=this;this.regRatingBase("priceBtn","rate","WikiPriceRating",function(e){t.setLikeDislike(e.$cont,e.like,"priceBtn"),e.$cont.prev().find(".price").text(e.res.toFixed(2))})},e.prototype.regRatingBase=function(e,i,o,r){var a=this;$("."+e).click(function(e){e.preventDefault();var s=$(e.target),l=s.data("like"),c=s.closest("."+i),g=c.data("id"),u={articleId:a.articleId,sectionId:g,language:a.langVersion,like:l};t.ViewBase.currentView.fullReg?t.ViewBase.currentView.apiPut(o,u,function(t){r({$cont:c,like:l,res:t})}):n.displayFullRegMessage()})},e.prototype.regRating=function(){var t=this;this.regRatingBase("ratingBtn","article_rating","WikiRating",function(e){if(t.setLikeDislike(e.$cont,e.like,"ratingBtn"),null!=e.res){var i=e.$cont.find(".score");i.removeClass("plus").removeClass("minus");var n=t.getRatingDesign(e.res);i.text(n.rstr),i.addClass(n.cls)}})},e.prototype.setLikeDislike=function(t,e,i){var n=t.find("."+i),o=n.toArray();n.removeClass("active"),o.forEach(function(t){var i=$(t),n=i.data("like");n&&e&&i.addClass("active"),n||e||i.addClass("active")})},e}();t.Rating=o;var r=function(){function e(e){this.articleId=e,$("#recommendPhoto").click(function(e){e.preventDefault(),t.ViewBase.currentView.fullReg?($("#photosForm").toggleClass("hidden"),$("#photoFormOpen").toggleClass("hidden")):n.displayFullRegMessage()}),$("#photosForm .cancel").click(function(t){t.preventDefault(),$("#photosForm").toggleClass("hidden"),$("#photoFormOpen").toggleClass("hidden")});var i=$("#photosForm #cid");i.change(function(t){t.preventDefault();var e=i.prop("checked");e?$(".photoButton").show():$(".photoButton").hide()}),this.registerPhotoUpload(this.articleId,"galleryInput")}return e.prototype.registerPhotoUpload=function(e,i){var n=new Common.FileUploadConfig;n.inputId=i,n.endpoint="WikiPhotoGallery";var o=new Common.FileUpload(n);o.customId=e,o.onProgressChanged=function(t){var e=$("#galleryProgress");e.show();var i=t+"%";$(".progress").css("width",i),e.find("span").text(i)},o.onUploadFinished=function(e,i){var n=$("#galleryProgress");n.hide();var o=new Common.InfoDialog,r=t.ViewBase.currentView;o.create(r.t("UploadTitle","jsWiki"),r.t("UploadBody","jsWiki"))}},e}();t.WikiPhotosUser=r}(Views||(Views={}));